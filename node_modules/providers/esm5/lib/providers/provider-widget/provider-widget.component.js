import { __decorate } from "tslib";
import { ChangeDetectorRef, Component, EventEmitter, Input, OnInit, Output } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Provider } from '@brightpath/common';
import { ProvidersService } from '@brightpath/scheduling';
var ProviderWidgetComponent = /** @class */ (function () {
    function ProviderWidgetComponent(providerService, http, cdr) {
        this.providerService = providerService;
        this.http = http;
        this.cdr = cdr;
        this.provider = new Provider({ id: 'unknown' });
        this.designatedProvider = false;
        this.onAppointmentCreated = new EventEmitter();
        this.onSelectedProvider = new EventEmitter();
        // tslint:disable-next-line:variable-name
        this._showAvailability = false;
        this.availabilityLoaded = false;
        this.showRating = false;
        this.showDetails = false;
        this.showPrivateMessage = false;
        this.loaded = false;
    }
    ProviderWidgetComponent.prototype.selectProvider = function (value) {
        console.log(value);
        if (value.checked) {
            this.onSelectedProvider.emit(this.provider);
        }
    };
    ProviderWidgetComponent.prototype.appointmentCreated = function (appointment) {
        this.onAppointmentCreated.emit(appointment);
    };
    ProviderWidgetComponent.prototype.clearAvailability = function () {
        this.showAvailability = false;
        this.availabilityLoaded = false;
    };
    ProviderWidgetComponent.prototype.onAvailabilityLoaded = function (event) {
        console.log('bam.  loaded');
        this.availabilityLoaded = true;
        this.cdr.detectChanges();
    };
    Object.defineProperty(ProviderWidgetComponent.prototype, "showAvailability", {
        get: function () {
            return this._showAvailability;
        },
        set: function (availability) {
            this._showAvailability = availability;
            this.cdr.detectChanges();
        },
        enumerable: true,
        configurable: true
    });
    ProviderWidgetComponent.prototype.onRatingSaved = function (event) {
        this.showRating = false;
        this.cdr.detectChanges();
    };
    ProviderWidgetComponent.prototype.ngOnInit = function () {
        var _this = this;
        // load the survey results for the provider
        if (this.provider.id === 'unknown') {
            this.providerService.getProviderById(this.providerId)
                .then(function (response) {
                _this.provider = response;
                _this.cdr.detectChanges();
            }, function (error) {
                console.log('An error occurred');
            });
        }
        else {
            this.providerId = this.provider.id;
        }
        var surveyUrl = "https://api-dev.brightpathvt.com/providers/surveyresults/" + this.providerId;
        this.http.get(surveyUrl)
            .subscribe(function (response) {
            _this.loaded = true;
            _this.providerDetails = response;
            console.log('details', response);
            // const licenses: any[] = this.providerDetails.licenses;
            // const licenseString = licenses.map((license: any) => {
            //   console.log('license', license);
            //   return license.name;
            // }).join(',');
            // console.log('licenseString', licenseString);
            _this.cdr.detectChanges();
        }, function (error) {
            _this.loaded = true;
            console.log('An error occurred');
            console.log(error);
        });
    };
    ProviderWidgetComponent.ctorParameters = function () { return [
        { type: ProvidersService },
        { type: HttpClient },
        { type: ChangeDetectorRef }
    ]; };
    __decorate([
        Input()
    ], ProviderWidgetComponent.prototype, "provider", void 0);
    __decorate([
        Input()
    ], ProviderWidgetComponent.prototype, "providerId", void 0);
    __decorate([
        Input()
    ], ProviderWidgetComponent.prototype, "designatedProvider", void 0);
    __decorate([
        Output()
    ], ProviderWidgetComponent.prototype, "onAppointmentCreated", void 0);
    __decorate([
        Output()
    ], ProviderWidgetComponent.prototype, "onSelectedProvider", void 0);
    ProviderWidgetComponent = __decorate([
        Component({
            selector: 'provider-widget',
            template: "<mat-card fxLayout=\"column\" class=\"p-0\">\n\n  <!-- Front -->\n  <div class=\"mat-white-bg mat-elevation-z2\">\n    <div fxLayout=\"row\" *ngIf=\"!designatedProvider\" class=\"p-16 mb-24 bb\">\n      <div class=\"mr-16\">\n        <mat-checkbox (change)=\"selectProvider($event)\"></mat-checkbox>\n      </div>\n      <div fxLayout=\"column\">\n        <div>Choose {{provider?.firstName}} as your preferred provider</div>\n      </div>\n    </div>\n    <div *ngIf=\"!showAvailability && !showRating && !showDetails && !showPrivateMessage\" class=\"mb-8\" fxLayout=\"column\">\n      <div *ngIf=\"designatedProvider\" class=\"font-size-18 text-center p-16 mb-24 bb\">\n        Your Counselor\n      </div>\n      <div fxLayout=\"column\" fxLayoutAlign=\"center center\">\n        <div>\n          <img *ngIf=\"loaded\" src=\"{{ provider?.imageUrl }}\" style=\"border-radius: 50%; width: 150px;\">\n          <mat-progress-spinner *ngIf=\"!loaded\" [strokeWidth]=\"4\" [diameter]=\"150\" mode=\"indeterminate\" class=\"mb-16\"></mat-progress-spinner>\n        </div>\n        <div *ngIf=\"loaded\" class=\"mt-24 mb-8\">\n          <div class=\"secondary-text font-size-18\">{{ provider?.firstName }} {{ provider?.lastName }}</div>\n        </div>\n        <div *ngIf=\"loaded\" class=\"text-center mb-16\" fxLayoutAlign=\"row\">\n          <mat-icon class=\"yellow-icon\">star</mat-icon>\n          <mat-icon class=\"yellow-icon\">star</mat-icon>\n          <mat-icon class=\"yellow-icon\">star</mat-icon>\n          <mat-icon class=\"yellow-icon\">star</mat-icon>\n          <mat-icon class=\"yellow-icon\">star</mat-icon>\n        </div>\n      </div>\n    </div>\n    <div *ngIf=\"showAvailability\" class=\"pt-8\" fxLayout=\"column\">\n      <div  *ngIf=\"designatedProvider\" class=\"mb-8\" fxLayout=\"row\">\n        <div fxFlex class=\"bb pb-8 pl-16 mat-title\">Your Counselor</div>\n      </div>\n      <div fxLayout=\"column\" class=\"mb-16\">\n        <div fxLayout=\"row\" fxLayoutAlign=\"start center\">\n          <mat-spinner class=\"ml-8 mr-8\" *ngIf=\"!availabilityLoaded\" [diameter]=\"25\"></mat-spinner>\n          <button *ngIf=\"availabilityLoaded\" mat-icon-button (click)=\"clearAvailability()\">\n            <mat-icon aria-label=\"Example icon-button with a heart icon\">arrow_back</mat-icon>\n          </button>\n          <div fxLayoutAlign=\"column\" class=\"mr-8 ml-8\">\n            <img src=\"{{ provider?.imageUrl }}\" style=\"border-radius: 50%; width: 40px; height: 40px;\">\n          </div>\n          <div fxLayout=\"column\">\n            <div class=\"secondary-text font-size-18 line-height-14\">{{ provider?.firstName }}</div>\n            <div class=\"secondary-text font-size-24\">{{ provider?.lastName }}</div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div *ngIf=\"showRating\" class=\"pt-8\" fxLayout=\"column\">\n      <div *ngIf=\"designatedProvider\" class=\"mb-8\" fxLayout=\"row\">\n        <div fxFlex class=\"bb pb-8 pl-16 mat-title\">Your Counselor</div>\n      </div>\n      <div fxLayout=\"column\" class=\"mb-16\">\n        <div fxLayout=\"row\" fxLayoutAlign=\"start center\">\n          <button mat-icon-button (click)=\"showRating = false;\">\n            <mat-icon aria-label=\"Cancel\">arrow_back</mat-icon>\n          </button>\n          <div fxLayoutAlign=\"column\" class=\"mr-8 ml-8\">\n            <img src=\"{{ provider?.imageUrl }}\" style=\"border-radius: 50%; width: 40px; height: 40px;\">\n          </div>\n          <div fxLayoutAlign=\"row\" class=\"secondary-text font-size-24\">Rate {{ provider?.firstName }}</div>\n        </div>\n      </div>\n    </div>\n    <div *ngIf=\"showDetails\" class=\"pt-8\" fxLayout=\"column\">\n      <div *ngIf=\"designatedProvider\" class=\"mb-8\" fxLayout=\"row\">\n        <div fxFlex class=\"bb pb-8 pl-16 mat-title\">Your Counselor</div>\n      </div>\n      <div fxLayout=\"column\" class=\"mb-16\">\n        <div fxLayout=\"row\" fxLayoutAlign=\"start center\">\n          <button mat-icon-button (click)=\"showDetails = false;\">\n            <mat-icon aria-label=\"Cancel\">arrow_back</mat-icon>\n          </button>\n          <div fxLayoutAlign=\"column\" class=\"mr-8 ml-8\">\n            <img src=\"{{ provider?.imageUrl }}\" style=\"border-radius: 50%; width: 40px; height: 40px;\">\n          </div>\n          <div fxLayoutAlign=\"row\" class=\"secondary-text font-size-24\">Meet {{ provider?.firstName }}</div>\n        </div>\n      </div>\n    </div>\n    <div *ngIf=\"showPrivateMessage\" class=\"pt-8\" fxLayout=\"column\">\n      <div *ngIf=\"designatedProvider\" class=\"mb-8\" fxLayout=\"row\">\n        <div fxFlex class=\"bb pb-8 pl-16 mat-title\">Your Counselor</div>\n      </div>\n      <div fxLayout=\"column\" class=\"mb-16\">\n        <div fxLayout=\"row\" fxLayoutAlign=\"start center\">\n          <button mat-icon-button (click)=\"showPrivateMessage = false;\">\n            <mat-icon aria-label=\"Cancel\">arrow_back</mat-icon>\n          </button>\n          <div fxLayoutAlign=\"column\" class=\"mr-8 ml-8\">\n            <img src=\"{{ provider?.imageUrl }}\" style=\"border-radius: 50%; width: 40px; height: 40px;\">\n          </div>\n          <div fxLayoutAlign=\"row\" class=\"secondary-text font-size-24\">Contact {{ provider?.firstName }}</div>\n        </div>\n      </div>\n    </div>\n    <provider-private-message (close)=\"showPrivateMessage = false\" [providerId]=\"provider.id\" *ngIf=\"showPrivateMessage\"></provider-private-message>\n    <provider-rating-widget (saved)=\"onRatingSaved($event)\" *ngIf=\"showRating\" [provider]=\"provider\"></provider-rating-widget>\n    <schedule-availability (appointmentCreated)=\"appointmentCreated($event)\" (availabilityLoaded)=\"onAvailabilityLoaded($event)\" *ngIf=\"showAvailability\" [providerId]=\"provider.id\"></schedule-availability>\n    <provider-details [providerDetails]=\"providerDetails\" *ngIf=\"showDetails\"></provider-details>\n\n    <div *ngIf=\"loaded\" class=\"py-8 grey-50-bg border-top\" fxLayout=\"column\">\n      <mat-nav-list>\n        <mat-list-item (click)=\"showDetails = true\">\n          <mat-icon matListIcon>person</mat-icon>\n          <div matLine>{{ provider?.firstName }}'s Profile</div>\n        </mat-list-item>\n        <mat-list-item (click)=\"showRating = true\">\n          <mat-icon matListIcon>star_rate</mat-icon>\n          <div matLine>Rate {{ provider?.firstName }}</div>\n        </mat-list-item>\n        <mat-list-item (click)=\"showAvailability = true\" *ngIf=\"provider.stripeAccountCreated == true\">\n          <mat-icon matListIcon>date_range</mat-icon>\n          <div matLine>Schedule an Appointment</div>\n        </mat-list-item>\n        <!--<mat-list-item (click)=\"showAvailability = true\" *ngIf=\"provider.stripeAccountCreated == false\">-->\n          <!--<mat-icon matListIcon>date_range</mat-icon>-->\n          <!--<div matLine>Request an Appointment</div>-->\n        <!--</mat-list-item>-->\n        <mat-list-item (click)=\"showPrivateMessage = true\">\n          <mat-icon matListIcon>message</mat-icon>\n          <div matLine>Send a Private Message</div>\n        </mat-list-item>\n      </mat-nav-list>\n    </div>\n  </div>\n</mat-card>\n",
            styles: [".yellow-icon{color:#fdd835}.yellow-icon svg{fill:#fdd835}"]
        })
    ], ProviderWidgetComponent);
    return ProviderWidgetComponent;
}());
export { ProviderWidgetComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvdmlkZXItd2lkZ2V0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3Byb3ZpZGVycy8iLCJzb3VyY2VzIjpbImxpYi9wcm92aWRlcnMvcHJvdmlkZXItd2lkZ2V0L3Byb3ZpZGVyLXdpZGdldC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBQyxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ2hHLE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxzQkFBc0IsQ0FBQztBQUNoRCxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFDNUMsT0FBTyxFQUFDLGdCQUFnQixFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFPeEQ7SUFpQkUsaUNBQ1csZUFBaUMsRUFDakMsSUFBZ0IsRUFDaEIsR0FBc0I7UUFGdEIsb0JBQWUsR0FBZixlQUFlLENBQWtCO1FBQ2pDLFNBQUksR0FBSixJQUFJLENBQVk7UUFDaEIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFsQnhCLGFBQVEsR0FBYSxJQUFJLFFBQVEsQ0FBQyxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO1FBRXJELHVCQUFrQixHQUFHLEtBQUssQ0FBQztRQUMxQix5QkFBb0IsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzFDLHVCQUFrQixHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFHbEQseUNBQXlDO1FBQ3pDLHNCQUFpQixHQUFHLEtBQUssQ0FBQztRQUMxQix1QkFBa0IsR0FBRyxLQUFLLENBQUM7UUFDM0IsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUNuQixnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUNwQix1QkFBa0IsR0FBRyxLQUFLLENBQUM7UUFDM0IsV0FBTSxHQUFHLEtBQUssQ0FBQztJQVFmLENBQUM7SUFFRCxnREFBYyxH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Q1gsaUJBQWlCOztJQWxCeEI7UUFBUixLQUFLLEVBQUU7NkRBQXNEO0lBQ3JEO1FBQVIsS0FBSyxFQUFFOytEQUFvQjtJQUNuQjtRQUFSLEtBQUssRUFBRTt1RUFBNEI7SUFDMUI7UUFBVCxNQUFNLEVBQUU7eUVBQTJDO0lBQzFDO1FBQVQsTUFBTSxFQUFFO3VFQUF5QztJQU52Qyx1QkFBdUI7UUFMbkMsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLGlCQUFpQjtZQUMzQiwybE9BQStDOztTQUVoRCxDQUFDO09BQ1csdUJBQXVCLENBZ0duQztJQUFELDhCQUFDO0NBQUEsQUFoR0QsSUFnR0M7U0FoR1ksdUJBQXVCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkluaXQsIE91dHB1dH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0h0dHBDbGllbnR9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7UHJvdmlkZXJ9IGZyb20gJ0BicmlnaHRwYXRoL2NvbW1vbic7XG5pbXBvcnQge1Byb3ZpZGVyc1NlcnZpY2V9IGZyb20gJ0BicmlnaHRwYXRoL3NjaGVkdWxpbmcnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwcm92aWRlci13aWRnZXQnLFxuICB0ZW1wbGF0ZVVybDogJy4vcHJvdmlkZXItd2lkZ2V0LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vcHJvdmlkZXItd2lkZ2V0LmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgUHJvdmlkZXJXaWRnZXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIEBJbnB1dCgpIHByb3ZpZGVyOiBQcm92aWRlciA9IG5ldyBQcm92aWRlcih7IGlkOiAndW5rbm93bicgfSk7XG4gIEBJbnB1dCgpIHByb3ZpZGVySWQ6IHN0cmluZztcbiAgQElucHV0KCkgZGVzaWduYXRlZFByb3ZpZGVyID0gZmFsc2U7XG4gIEBPdXRwdXQoKSBvbkFwcG9pbnRtZW50Q3JlYXRlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIG9uU2VsZWN0ZWRQcm92aWRlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBwcm92aWRlckRldGFpbHM6IGFueTtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnZhcmlhYmxlLW5hbWVcbiAgX3Nob3dBdmFpbGFiaWxpdHkgPSBmYWxzZTtcbiAgYXZhaWxhYmlsaXR5TG9hZGVkID0gZmFsc2U7XG4gIHNob3dSYXRpbmcgPSBmYWxzZTtcbiAgc2hvd0RldGFpbHMgPSBmYWxzZTtcbiAgc2hvd1ByaXZhdGVNZXNzYWdlID0gZmFsc2U7XG4gIGxvYWRlZCA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgICBwcml2YXRlIHByb3ZpZGVyU2VydmljZTogUHJvdmlkZXJzU2VydmljZSxcbiAgICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxuICAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWZcbiAgKSB7XG5cbiAgfVxuXG4gIHNlbGVjdFByb3ZpZGVyKHZhbHVlKSB7XG4gICAgY29uc29sZS5sb2codmFsdWUpO1xuICAgIGlmICh2YWx1ZS5jaGVja2VkKSB7XG4gICAgICB0aGlzLm9uU2VsZWN0ZWRQcm92aWRlci5lbWl0KHRoaXMucHJvdmlkZXIpO1xuICAgIH1cbiAgfVxuXG4gIGFwcG9pbnRtZW50Q3JlYXRlZChhcHBvaW50bWVudCkge1xuICAgIHRoaXMub25BcHBvaW50bWVudENyZWF0ZWQuZW1pdChhcHBvaW50bWVudCk7XG4gIH1cblxuICBjbGVhckF2YWlsYWJpbGl0eSgpIHtcbiAgICB0aGlzLnNob3dBdmFpbGFiaWxpdHkgPSBmYWxzZTtcbiAgICB0aGlzLmF2YWlsYWJpbGl0eUxvYWRlZCA9IGZhbHNlO1xuICB9XG5cbiAgb25BdmFpbGFiaWxpdHlMb2FkZWQoZXZlbnQpIHtcbiAgICBjb25zb2xlLmxvZygnYmFtLiAgbG9hZGVkJyk7XG4gICAgdGhpcy5hdmFpbGFiaWxpdHlMb2FkZWQgPSB0cnVlO1xuICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIHNldCBzaG93QXZhaWxhYmlsaXR5KGF2YWlsYWJpbGl0eTogYm9vbGVhbikge1xuICAgIHRoaXMuX3Nob3dBdmFpbGFiaWxpdHkgPSBhdmFpbGFiaWxpdHk7XG4gICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgZ2V0IHNob3dBdmFpbGFiaWxpdHkoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3Nob3dBdmFpbGFiaWxpdHk7XG4gIH1cblxuICBvblJhdGluZ1NhdmVkKGV2ZW50KSB7XG4gICAgdGhpcy5zaG93UmF0aW5nID0gZmFsc2U7XG4gICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgLy8gbG9hZCB0aGUgc3VydmV5IHJlc3VsdHMgZm9yIHRoZSBwcm92aWRlclxuICAgIGlmICh0aGlzLnByb3ZpZGVyLmlkID09PSAndW5rbm93bicpIHtcbiAgICAgIHRoaXMucHJvdmlkZXJTZXJ2aWNlLmdldFByb3ZpZGVyQnlJZCh0aGlzLnByb3ZpZGVySWQpXG4gICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIHRoaXMucHJvdmlkZXIgPSByZXNwb25zZSBhcyBQcm92aWRlcjtcbiAgICAgICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdBbiBlcnJvciBvY2N1cnJlZCcpO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wcm92aWRlcklkID0gdGhpcy5wcm92aWRlci5pZDtcbiAgICB9XG5cbiAgICBjb25zdCBzdXJ2ZXlVcmwgPSBgaHR0cHM6Ly9hcGktZGV2LmJyaWdodHBhdGh2dC5jb20vcHJvdmlkZXJzL3N1cnZleXJlc3VsdHMvJHt0aGlzLnByb3ZpZGVySWR9YDtcbiAgICB0aGlzLmh0dHAuZ2V0KHN1cnZleVVybClcbiAgICAgIC5zdWJzY3JpYmUoKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5wcm92aWRlckRldGFpbHMgPSByZXNwb25zZTtcbiAgICAgICAgY29uc29sZS5sb2coJ2RldGFpbHMnLCByZXNwb25zZSk7XG4gICAgICAgIC8vIGNvbnN0IGxpY2Vuc2VzOiBhbnlbXSA9IHRoaXMucHJvdmlkZXJEZXRhaWxzLmxpY2Vuc2VzO1xuICAgICAgICAvLyBjb25zdCBsaWNlbnNlU3RyaW5nID0gbGljZW5zZXMubWFwKChsaWNlbnNlOiBhbnkpID0+IHtcbiAgICAgICAgLy8gICBjb25zb2xlLmxvZygnbGljZW5zZScsIGxpY2Vuc2UpO1xuICAgICAgICAvLyAgIHJldHVybiBsaWNlbnNlLm5hbWU7XG4gICAgICAgIC8vIH0pLmpvaW4oJywnKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ2xpY2Vuc2VTdHJpbmcnLCBsaWNlbnNlU3RyaW5nKTtcbiAgICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgY29uc29sZS5sb2coJ0FuIGVycm9yIG9jY3VycmVkJyk7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgIH0pO1xuICB9XG5cblxufVxuIl19