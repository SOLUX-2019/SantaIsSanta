import { __decorate } from "tslib";
import { ChangeDetectorRef, Component, EventEmitter, Input, OnInit, Output } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Provider } from '@brightpath/common';
import { ProvidersService } from '@brightpath/scheduling';
let ProviderWidgetComponent = class ProviderWidgetComponent {
    constructor(providerService, http, cdr) {
        this.providerService = providerService;
        this.http = http;
        this.cdr = cdr;
        this.provider = new Provider({ id: 'unknown' });
        this.designatedProvider = false;
        this.onAppointmentCreated = new EventEmitter();
        this.onSelectedProvider = new EventEmitter();
        // tslint:disable-next-line:variable-name
        this._showAvailability = false;
        this.availabilityLoaded = false;
        this.showRating = false;
        this.showDetails = false;
        this.showPrivateMessage = false;
        this.loaded = false;
    }
    selectProvider(value) {
        console.log(value);
        if (value.checked) {
            this.onSelectedProvider.emit(this.provider);
        }
    }
    appointmentCreated(appointment) {
        this.onAppointmentCreated.emit(appointment);
    }
    clearAvailability() {
        this.showAvailability = false;
        this.availabilityLoaded = false;
    }
    onAvailabilityLoaded(event) {
        console.log('bam.  loaded');
        this.availabilityLoaded = true;
        this.cdr.detectChanges();
    }
    set showAvailability(availability) {
        this._showAvailability = availability;
        this.cdr.detectChanges();
    }
    get showAvailability() {
        return this._showAvailability;
    }
    onRatingSaved(event) {
        this.showRating = false;
        this.cdr.detectChanges();
    }
    ngOnInit() {
        // load the survey results for the provider
        if (this.provider.id === 'unknown') {
            this.providerService.getProviderById(this.providerId)
                .then((response) => {
                this.provider = response;
                this.cdr.detectChanges();
            }, (error) => {
                console.log('An error occurred');
            });
        }
        else {
            this.providerId = this.provider.id;
        }
        const surveyUrl = `https://api-dev.brightpathvt.com/providers/surveyresults/${this.providerId}`;
        this.http.get(surveyUrl)
            .subscribe((response) => {
            this.loaded = true;
            this.providerDetails = response;
            console.log('details', response);
            // const licenses: any[] = this.providerDetails.licenses;
            // const licenseString = licenses.map((license: any) => {
            //   console.log('license', license);
            //   return license.name;
            // }).join(',');
            // console.log('licenseString', licenseString);
            this.cdr.detectChanges();
        }, (error) => {
            this.loaded = true;
            console.log('An error occurred');
            console.log(error);
        });
    }
};
ProviderWidgetComponent.ctorParameters = () => [
    { type: ProvidersService },
    { type: HttpClient },
    { type: ChangeDetectorRef }
];
__decorate([
    Input()
], ProviderWidgetComponent.prototype, "provider", void 0);
__decorate([
    Input()
], ProviderWidgetComponent.prototype, "providerId", void 0);
__decorate([
    Input()
], ProviderWidgetComponent.prototype, "designatedProvider", void 0);
__decorate([
    Output()
], ProviderWidgetComponent.prototype, "onAppointmentCreated", void 0);
__decorate([
    Output()
], ProviderWidgetComponent.prototype, "onSelectedProvider", void 0);
ProviderWidgetComponent = __decorate([
    Component({
        selector: 'provider-widget',
        template: "<mat-card fxLayout=\"column\" class=\"p-0\">\n\n  <!-- Front -->\n  <div class=\"mat-white-bg mat-elevation-z2\">\n    <div fxLayout=\"row\" *ngIf=\"!designatedProvider\" class=\"p-16 mb-24 bb\">\n      <div class=\"mr-16\">\n        <mat-checkbox (change)=\"selectProvider($event)\"></mat-checkbox>\n      </div>\n      <div fxLayout=\"column\">\n        <div>Choose {{provider?.firstName}} as your preferred provider</div>\n      </div>\n    </div>\n    <div *ngIf=\"!showAvailability && !showRating && !showDetails && !showPrivateMessage\" class=\"mb-8\" fxLayout=\"column\">\n      <div *ngIf=\"designatedProvider\" class=\"font-size-18 text-center p-16 mb-24 bb\">\n        Your Counselor\n      </div>\n      <div fxLayout=\"column\" fxLayoutAlign=\"center center\">\n        <div>\n          <img *ngIf=\"loaded\" src=\"{{ provider?.imageUrl }}\" style=\"border-radius: 50%; width: 150px;\">\n          <mat-progress-spinner *ngIf=\"!loaded\" [strokeWidth]=\"4\" [diameter]=\"150\" mode=\"indeterminate\" class=\"mb-16\"></mat-progress-spinner>\n        </div>\n        <div *ngIf=\"loaded\" class=\"mt-24 mb-8\">\n          <div class=\"secondary-text font-size-18\">{{ provider?.firstName }} {{ provider?.lastName }}</div>\n        </div>\n        <div *ngIf=\"loaded\" class=\"text-center mb-16\" fxLayoutAlign=\"row\">\n          <mat-icon class=\"yellow-icon\">star</mat-icon>\n          <mat-icon class=\"yellow-icon\">star</mat-icon>\n          <mat-icon class=\"yellow-icon\">star</mat-icon>\n          <mat-icon class=\"yellow-icon\">star</mat-icon>\n          <mat-icon class=\"yellow-icon\">star</mat-icon>\n        </div>\n      </div>\n    </div>\n    <div *ngIf=\"showAvailability\" class=\"pt-8\" fxLayout=\"column\">\n      <div  *ngIf=\"designatedProvider\" class=\"mb-8\" fxLayout=\"row\">\n        <div fxFlex class=\"bb pb-8 pl-16 mat-title\">Your Counselor</div>\n      </div>\n      <div fxLayout=\"column\" class=\"mb-16\">\n        <div fxLayout=\"row\" fxLayoutAlign=\"start center\">\n          <mat-spinner class=\"ml-8 mr-8\" *ngIf=\"!availabilityLoaded\" [diameter]=\"25\"></mat-spinner>\n          <button *ngIf=\"availabilityLoaded\" mat-icon-button (click)=\"clearAvailability()\">\n            <mat-icon aria-label=\"Example icon-button with a heart icon\">arrow_back</mat-icon>\n          </button>\n          <div fxLayoutAlign=\"column\" class=\"mr-8 ml-8\">\n            <img src=\"{{ provider?.imageUrl }}\" style=\"border-radius: 50%; width: 40px; height: 40px;\">\n          </div>\n          <div fxLayout=\"column\">\n            <div class=\"secondary-text font-size-18 line-height-14\">{{ provider?.firstName }}</div>\n            <div class=\"secondary-text font-size-24\">{{ provider?.lastName }}</div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div *ngIf=\"showRating\" class=\"pt-8\" fxLayout=\"column\">\n      <div *ngIf=\"designatedProvider\" class=\"mb-8\" fxLayout=\"row\">\n        <div fxFlex class=\"bb pb-8 pl-16 mat-title\">Your Counselor</div>\n      </div>\n      <div fxLayout=\"column\" class=\"mb-16\">\n        <div fxLayout=\"row\" fxLayoutAlign=\"start center\">\n          <button mat-icon-button (click)=\"showRating = false;\">\n            <mat-icon aria-label=\"Cancel\">arrow_back</mat-icon>\n          </button>\n          <div fxLayoutAlign=\"column\" class=\"mr-8 ml-8\">\n            <img src=\"{{ provider?.imageUrl }}\" style=\"border-radius: 50%; width: 40px; height: 40px;\">\n          </div>\n          <div fxLayoutAlign=\"row\" class=\"secondary-text font-size-24\">Rate {{ provider?.firstName }}</div>\n        </div>\n      </div>\n    </div>\n    <div *ngIf=\"showDetails\" class=\"pt-8\" fxLayout=\"column\">\n      <div *ngIf=\"designatedProvider\" class=\"mb-8\" fxLayout=\"row\">\n        <div fxFlex class=\"bb pb-8 pl-16 mat-title\">Your Counselor</div>\n      </div>\n      <div fxLayout=\"column\" class=\"mb-16\">\n        <div fxLayout=\"row\" fxLayoutAlign=\"start center\">\n          <button mat-icon-button (click)=\"showDetails = false;\">\n            <mat-icon aria-label=\"Cancel\">arrow_back</mat-icon>\n          </button>\n          <div fxLayoutAlign=\"column\" class=\"mr-8 ml-8\">\n            <img src=\"{{ provider?.imageUrl }}\" style=\"border-radius: 50%; width: 40px; height: 40px;\">\n          </div>\n          <div fxLayoutAlign=\"row\" class=\"secondary-text font-size-24\">Meet {{ provider?.firstName }}</div>\n        </div>\n      </div>\n    </div>\n    <div *ngIf=\"showPrivateMessage\" class=\"pt-8\" fxLayout=\"column\">\n      <div *ngIf=\"designatedProvider\" class=\"mb-8\" fxLayout=\"row\">\n        <div fxFlex class=\"bb pb-8 pl-16 mat-title\">Your Counselor</div>\n      </div>\n      <div fxLayout=\"column\" class=\"mb-16\">\n        <div fxLayout=\"row\" fxLayoutAlign=\"start center\">\n          <button mat-icon-button (click)=\"showPrivateMessage = false;\">\n            <mat-icon aria-label=\"Cancel\">arrow_back</mat-icon>\n          </button>\n          <div fxLayoutAlign=\"column\" class=\"mr-8 ml-8\">\n            <img src=\"{{ provider?.imageUrl }}\" style=\"border-radius: 50%; width: 40px; height: 40px;\">\n          </div>\n          <div fxLayoutAlign=\"row\" class=\"secondary-text font-size-24\">Contact {{ provider?.firstName }}</div>\n        </div>\n      </div>\n    </div>\n    <provider-private-message (close)=\"showPrivateMessage = false\" [providerId]=\"provider.id\" *ngIf=\"showPrivateMessage\"></provider-private-message>\n    <provider-rating-widget (saved)=\"onRatingSaved($event)\" *ngIf=\"showRating\" [provider]=\"provider\"></provider-rating-widget>\n    <schedule-availability (appointmentCreated)=\"appointmentCreated($event)\" (availabilityLoaded)=\"onAvailabilityLoaded($event)\" *ngIf=\"showAvailability\" [providerId]=\"provider.id\"></schedule-availability>\n    <provider-details [providerDetails]=\"providerDetails\" *ngIf=\"showDetails\"></provider-details>\n\n    <div *ngIf=\"loaded\" class=\"py-8 grey-50-bg border-top\" fxLayout=\"column\">\n      <mat-nav-list>\n        <mat-list-item (click)=\"showDetails = true\">\n          <mat-icon matListIcon>person</mat-icon>\n          <div matLine>{{ provider?.firstName }}'s Profile</div>\n        </mat-list-item>\n        <mat-list-item (click)=\"showRating = true\">\n          <mat-icon matListIcon>star_rate</mat-icon>\n          <div matLine>Rate {{ provider?.firstName }}</div>\n        </mat-list-item>\n        <mat-list-item (click)=\"showAvailability = true\" *ngIf=\"provider.stripeAccountCreated == true\">\n          <mat-icon matListIcon>date_range</mat-icon>\n          <div matLine>Schedule an Appointment</div>\n        </mat-list-item>\n        <!--<mat-list-item (click)=\"showAvailability = true\" *ngIf=\"provider.stripeAccountCreated == false\">-->\n          <!--<mat-icon matListIcon>date_range</mat-icon>-->\n          <!--<div matLine>Request an Appointment</div>-->\n        <!--</mat-list-item>-->\n        <mat-list-item (click)=\"showPrivateMessage = true\">\n          <mat-icon matListIcon>message</mat-icon>\n          <div matLine>Send a Private Message</div>\n        </mat-list-item>\n      </mat-nav-list>\n    </div>\n  </div>\n</mat-card>\n",
        styles: [".yellow-icon{color:#fdd835}.yellow-icon svg{fill:#fdd835}"]
    })
], ProviderWidgetComponent);
export { ProviderWidgetComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvdmlkZXItd2lkZ2V0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3Byb3ZpZGVycy8iLCJzb3VyY2VzIjpbImxpYi9wcm92aWRlcnMvcHJvdmlkZXItd2lkZ2V0L3Byb3ZpZGVyLXdpZGdldC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBQyxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ2hHLE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxzQkFBc0IsQ0FBQztBQUNoRCxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFDNUMsT0FBTyxFQUFDLGdCQUFnQixFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFPeEQsSUFBYSx1QkFBdUIsR0FBcEMsTUFBYSx1QkFBdUI7SUFpQmxDLFlBQ1csZUFBaUMsRUFDakMsSUFBZ0IsRUFDaEIsR0FBc0I7UUFGdEIsb0JBQWUsR0FBZixlQUFlLENBQWtCO1FBQ2pDLFNBQUksR0FBSixJQUFJLENBQVk7UUFDaEIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFsQnhCLGFBQVEsR0FBYSxJQUFJLFFBQVEsQ0FBQyxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO1FBRXJELHVCQUFrQixHQUFHLEtBQUssQ0FBQztRQUMxQix5QkFBb0IsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzFDLHVCQUFrQixHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFHbEQseUNBQXlDO1FBQ3pDLHNCQUFpQixHQUFHLEtBQUssQ0FBQztRQUMxQix1QkFBa0IsR0FBRyxLQUFLLENBQUM7UUFDM0IsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUNuQixnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUNwQix1QkFBa0IsR0FBRyxLQUFLLENBQUM7UUFDM0IsV0FBTSxHQUFHLEtB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QTs7WUE5RTZCLGdCQUFnQjtZQUMzQixVQUFVO1lBQ1gsaUJBQWlCOztBQWxCeEI7SUFBUixLQUFLLEVBQUU7eURBQXNEO0FBQ3JEO0lBQVIsS0FBSyxFQUFFOzJEQUFvQjtBQUNuQjtJQUFSLEtBQUssRUFBRTttRUFBNEI7QUFDMUI7SUFBVCxNQUFNLEVBQUU7cUVBQTJDO0FBQzFDO0lBQVQsTUFBTSxFQUFFO21FQUF5QztBQU52Qyx1QkFBdUI7SUFMbkMsU0FBUyxDQUFDO1FBQ1QsUUFBUSxFQUFFLGlCQUFpQjtRQUMzQiwybE9BQStDOztLQUVoRCxDQUFDO0dBQ1csdUJBQXVCLENBZ0duQztTQWhHWSx1QkFBdUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7SHR0cENsaWVudH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHtQcm92aWRlcn0gZnJvbSAnQGJyaWdodHBhdGgvY29tbW9uJztcbmltcG9ydCB7UHJvdmlkZXJzU2VydmljZX0gZnJvbSAnQGJyaWdodHBhdGgvc2NoZWR1bGluZyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3Byb3ZpZGVyLXdpZGdldCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9wcm92aWRlci13aWRnZXQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9wcm92aWRlci13aWRnZXQuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBQcm92aWRlcldpZGdldENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgQElucHV0KCkgcHJvdmlkZXI6IFByb3ZpZGVyID0gbmV3IFByb3ZpZGVyKHsgaWQ6ICd1bmtub3duJyB9KTtcbiAgQElucHV0KCkgcHJvdmlkZXJJZDogc3RyaW5nO1xuICBASW5wdXQoKSBkZXNpZ25hdGVkUHJvdmlkZXIgPSBmYWxzZTtcbiAgQE91dHB1dCgpIG9uQXBwb2ludG1lbnRDcmVhdGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgb25TZWxlY3RlZFByb3ZpZGVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIHByb3ZpZGVyRGV0YWlsczogYW55O1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dmFyaWFibGUtbmFtZVxuICBfc2hvd0F2YWlsYWJpbGl0eSA9IGZhbHNlO1xuICBhdmFpbGFiaWxpdHlMb2FkZWQgPSBmYWxzZTtcbiAgc2hvd1JhdGluZyA9IGZhbHNlO1xuICBzaG93RGV0YWlscyA9IGZhbHNlO1xuICBzaG93UHJpdmF0ZU1lc3NhZ2UgPSBmYWxzZTtcbiAgbG9hZGVkID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgIHByaXZhdGUgcHJvdmlkZXJTZXJ2aWNlOiBQcm92aWRlcnNTZXJ2aWNlLFxuICAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXG4gICAgIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZlxuICApIHtcblxuICB9XG5cbiAgc2VsZWN0UHJvdmlkZXIodmFsdWUpIHtcbiAgICBjb25zb2xlLmxvZyh2YWx1ZSk7XG4gICAgaWYgKHZhbHVlLmNoZWNrZWQpIHtcbiAgICAgIHRoaXMub25TZWxlY3RlZFByb3ZpZGVyLmVtaXQodGhpcy5wcm92aWRlcik7XG4gICAgfVxuICB9XG5cbiAgYXBwb2ludG1lbnRDcmVhdGVkKGFwcG9pbnRtZW50KSB7XG4gICAgdGhpcy5vbkFwcG9pbnRtZW50Q3JlYXRlZC5lbWl0KGFwcG9pbnRtZW50KTtcbiAgfVxuXG4gIGNsZWFyQXZhaWxhYmlsaXR5KCkge1xuICAgIHRoaXMuc2hvd0F2YWlsYWJpbGl0eSA9IGZhbHNlO1xuICAgIHRoaXMuYXZhaWxhYmlsaXR5TG9hZGVkID0gZmFsc2U7XG4gIH1cblxuICBvbkF2YWlsYWJpbGl0eUxvYWRlZChldmVudCkge1xuICAgIGNvbnNvbGUubG9nKCdiYW0uICBsb2FkZWQnKTtcbiAgICB0aGlzLmF2YWlsYWJpbGl0eUxvYWRlZCA9IHRydWU7XG4gICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgc2V0IHNob3dBdmFpbGFiaWxpdHkoYXZhaWxhYmlsaXR5OiBib29sZWFuKSB7XG4gICAgdGhpcy5fc2hvd0F2YWlsYWJpbGl0eSA9IGF2YWlsYWJpbGl0eTtcbiAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICBnZXQgc2hvd0F2YWlsYWJpbGl0eSgpIHtcbiAgICByZXR1cm4gdGhpcy5fc2hvd0F2YWlsYWJpbGl0eTtcbiAgfVxuXG4gIG9uUmF0aW5nU2F2ZWQoZXZlbnQpIHtcbiAgICB0aGlzLnNob3dSYXRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICAvLyBsb2FkIHRoZSBzdXJ2ZXkgcmVzdWx0cyBmb3IgdGhlIHByb3ZpZGVyXG4gICAgaWYgKHRoaXMucHJvdmlkZXIuaWQgPT09ICd1bmtub3duJykge1xuICAgICAgdGhpcy5wcm92aWRlclNlcnZpY2UuZ2V0UHJvdmlkZXJCeUlkKHRoaXMucHJvdmlkZXJJZClcbiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgdGhpcy5wcm92aWRlciA9IHJlc3BvbnNlIGFzIFByb3ZpZGVyO1xuICAgICAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0FuIGVycm9yIG9jY3VycmVkJyk7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb3ZpZGVySWQgPSB0aGlzLnByb3ZpZGVyLmlkO1xuICAgIH1cblxuICAgIGNvbnN0IHN1cnZleVVybCA9IGBodHRwczovL2FwaS1kZXYuYnJpZ2h0cGF0aHZ0LmNvbS9wcm92aWRlcnMvc3VydmV5cmVzdWx0cy8ke3RoaXMucHJvdmlkZXJJZH1gO1xuICAgIHRoaXMuaHR0cC5nZXQoc3VydmV5VXJsKVxuICAgICAgLnN1YnNjcmliZSgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgdGhpcy5sb2FkZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLnByb3ZpZGVyRGV0YWlscyA9IHJlc3BvbnNlO1xuICAgICAgICBjb25zb2xlLmxvZygnZGV0YWlscycsIHJlc3BvbnNlKTtcbiAgICAgICAgLy8gY29uc3QgbGljZW5zZXM6IGFueVtdID0gdGhpcy5wcm92aWRlckRldGFpbHMubGljZW5zZXM7XG4gICAgICAgIC8vIGNvbnN0IGxpY2Vuc2VTdHJpbmcgPSBsaWNlbnNlcy5tYXAoKGxpY2Vuc2U6IGFueSkgPT4ge1xuICAgICAgICAvLyAgIGNvbnNvbGUubG9nKCdsaWNlbnNlJywgbGljZW5zZSk7XG4gICAgICAgIC8vICAgcmV0dXJuIGxpY2Vuc2UubmFtZTtcbiAgICAgICAgLy8gfSkuam9pbignLCcpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnbGljZW5zZVN0cmluZycsIGxpY2Vuc2VTdHJpbmcpO1xuICAgICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgdGhpcy5sb2FkZWQgPSB0cnVlO1xuICAgICAgICBjb25zb2xlLmxvZygnQW4gZXJyb3Igb2NjdXJyZWQnKTtcbiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgfSk7XG4gIH1cblxuXG59XG4iXX0=