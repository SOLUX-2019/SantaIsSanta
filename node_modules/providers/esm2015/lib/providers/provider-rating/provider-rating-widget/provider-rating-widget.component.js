import { __decorate } from "tslib";
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { FormControl, Validators } from '@angular/forms';
import { HttpClient } from '@angular/common/http';
import { CustomerReview } from '../customer-review';
import { ActivatedRoute, Router } from '@angular/router';
import { MatSnackBar } from '@angular/material/snack-bar';
import { ProvidersService } from '@brightpath/scheduling';
let ProviderRatingWidgetComponent = class ProviderRatingWidgetComponent {
    constructor(providerService, http, snackbar, router, route) {
        this.providerService = providerService;
        this.http = http;
        this.snackbar = snackbar;
        this.router = router;
        this.route = route;
        this.providerId = '';
        this.customerId = '';
        this.rating = 0;
        this.ratings = [];
        this.commentFormControl = new FormControl('', [Validators.required]);
        this.loading = false;
        this.loadingReviews = false;
        this.saved = new EventEmitter();
    }
    ngOnInit() {
        this.loadingReviews = true;
        this.providerService.getProviderById(this.provider.id)
            .then((response) => {
            console.log(response);
            this.provider = response;
        }, (error) => {
            console.log('Error getting provider');
            console.log(error);
        });
        this.providerService.getRatingsForProvider(this.provider.id)
            .then((response) => {
            console.log('success', response);
            this.ratings = response;
            this.loadingReviews = false;
        });
    }
    onRatingChanged(rating) {
        console.log('Changed: ' + rating);
        this.rating = rating;
    }
    submitRating() {
        const customerReview = new CustomerReview();
        customerReview.id = this.provider.id;
        customerReview.range = this.customerId;
        customerReview.submittedOn = new Date().getTime();
        customerReview.rating = this.rating;
        customerReview.comments = this.commentFormControl.value;
        const reviewUrl = `https://api-dev.brightpathvt.com/customers/reviews`;
        this.loading = true;
        console.log('customerreview', customerReview);
        this.http.post(reviewUrl, customerReview)
            .subscribe((response) => {
            this.loading = false;
            this.snackbar.open('Review Saved', 'OK', {
                verticalPosition: 'top',
                duration: 2000
            });
            // show the success message
            this.saved.emit(response);
            // this.router.navigateByUrl('/home');
        }, (error) => {
            this.loading = false;
        }, () => {
            this.loading = false;
        });
    }
};
ProviderRatingWidgetComponent.ctorParameters = () => [
    { type: ProvidersService },
    { type: HttpClient },
    { type: MatSnackBar },
    { type: Router },
    { type: ActivatedRoute }
];
__decorate([
    Input()
], ProviderRatingWidgetComponent.prototype, "provider", void 0);
__decorate([
    Input()
], ProviderRatingWidgetComponent.prototype, "providerId", void 0);
__decorate([
    Input()
], ProviderRatingWidgetComponent.prototype, "customerId", void 0);
__decorate([
    Output()
], ProviderRatingWidgetComponent.prototype, "saved", void 0);
ProviderRatingWidgetComponent = __decorate([
    Component({
        selector: 'provider-rating-widget',
        template: "<div fxLayout=\"column\" class=\"p-16 orange-50-bg\">\n  <div>\n    1.  On a scale of five stars, how pleased are you with the counseling services you have received from {{ provider?.firstName }}?\n  </div>\n  <div fxLayout=\"row\" fxLayoutAlign=\"center\" class=\"mt-16\">\n    <mat-star-rating\n      [rating]=\"rating\"\n      starCount=\"5\"\n      color=\"accent\"\n      (ratingUpdated)=\"onRatingChanged($event)\">\n    </mat-star-rating>\n  </div>\n  <div class=\"mt-16\">\n    2.  Please comment on why you have given {{ provider?.firstName }} the rating above.\n  </div>\n  <div fxLayout=\"row\" class=\"mt-16\">\n    <mat-form-field fxFlex>\n      <textarea placeholder=\"Comments\" matInput [formControl]=\"commentFormControl\"></textarea>\n      <mat-error>\n        Required\n      </mat-error>\n    </mat-form-field>\n  </div>\n  <div fxLayout=\"row\" class=\"mt-16\">\n    <div fxLayout=\"row\" fxLayoutAlign=\"end\" *ngIf=\"loading\">\n      <mat-spinner [diameter]=\"25\"></mat-spinner>\n    </div>\n    <button mat-raised-button (click)=\"submitRating()\" [disabled]=\"loading\">Submit</button>\n  </div>\n</div>\n<div class=\"mt-16 p-16\">\n  <div class=\"mat-title\">\n    Reviews\n  </div>\n  <provider-rating-item *ngFor=\"let rating of ratings\" [customerRating]=\"rating\"></provider-rating-item>\n  <div fxLayout=\"row\" fxLayoutAlign=\"center center\" *ngIf=\"loadingReviews\">\n    <mat-spinner [diameter]=\"25\"></mat-spinner>\n    <div class=\"ml-8\">Loading...</div>\n  </div>\n</div>\n\n",
        styles: [""]
    })
], ProviderRatingWidgetComponent);
export { ProviderRatingWidgetComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvdmlkZXItcmF0aW5nLXdpZGdldC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9wcm92aWRlcnMvIiwic291cmNlcyI6WyJsaWIvcHJvdmlkZXJzL3Byb3ZpZGVyLXJhdGluZy9wcm92aWRlci1yYXRpbmctd2lkZ2V0L3Byb3ZpZGVyLXJhdGluZy13aWRnZXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQVUsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQzdFLE9BQU8sRUFBQyxXQUFXLEVBQUUsVUFBVSxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkQsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQ2hELE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQztBQUNsRCxPQUFPLEVBQUMsY0FBYyxFQUFFLE1BQU0sRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUUxRCxPQUFPLEVBQUMsZ0JBQWdCLEVBQUMsTUFBTSx3QkFBd0IsQ0FBQztBQU94RCxJQUFhLDZCQUE2QixHQUExQyxNQUFhLDZCQUE2QjtJQWN4QyxZQUFvQixlQUFpQyxFQUNqQyxJQUFnQixFQUNoQixRQUFxQixFQUNyQixNQUFjLEVBQ2QsS0FBcUI7UUFKckIsb0JBQWUsR0FBZixlQUFlLENBQWtCO1FBQ2pDLFNBQUksR0FBSixJQUFJLENBQVk7UUFDaEIsYUFBUSxHQUFSLFFBQVEsQ0FBYTtRQUNyQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFmaEMsZUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNoQixlQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ3pCLFdBQU0sR0FBRyxDQUFDLENBQUM7UUFDWCxZQUFPLEdBQUcsRUFBRSxDQUFD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QUFLLENBQUM7UUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0NBRUYsQ0FBQTs7WUFoRXNDLGdCQUFnQjtZQUMzQixVQUFVO1lBQ04sV0FBVztZQUNiLE1BQU07WUFDUCxjQUFjOztBQWhCaEM7SUFBUixLQUFLLEVBQUU7K0RBQW9CO0FBQ25CO0lBQVIsS0FBSyxFQUFFO2lFQUFpQjtBQUNoQjtJQUFSLEtBQUssRUFBRTtpRUFBaUI7QUFPZjtJQUFULE1BQU0sRUFBRTs0REFBNEI7QUFYMUIsNkJBQTZCO0lBTHpDLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSx3QkFBd0I7UUFDbEMsMi9DQUFzRDs7S0FFdkQsQ0FBQztHQUNXLDZCQUE2QixDQThFekM7U0E5RVksNkJBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Rm9ybUNvbnRyb2wsIFZhbGlkYXRvcnN9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7SHR0cENsaWVudH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHtDdXN0b21lclJldmlld30gZnJvbSAnLi4vY3VzdG9tZXItcmV2aWV3JztcbmltcG9ydCB7QWN0aXZhdGVkUm91dGUsIFJvdXRlcn0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IE1hdFNuYWNrQmFyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvc25hY2stYmFyJztcbmltcG9ydCB7UHJvdmlkZXJ9IGZyb20gJ0BicmlnaHRwYXRoL2NvbW1vbic7XG5pbXBvcnQge1Byb3ZpZGVyc1NlcnZpY2V9IGZyb20gJ0BicmlnaHRwYXRoL3NjaGVkdWxpbmcnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwcm92aWRlci1yYXRpbmctd2lkZ2V0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3Byb3ZpZGVyLXJhdGluZy13aWRnZXQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9wcm92aWRlci1yYXRpbmctd2lkZ2V0LmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgUHJvdmlkZXJSYXRpbmdXaWRnZXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIEBJbnB1dCgpIHByb3ZpZGVyOiBQcm92aWRlcjtcbiAgQElucHV0KCkgcHJvdmlkZXJJZCA9ICcnO1xuICBASW5wdXQoKSBjdXN0b21lcklkID0gJyc7XG4gIHJhdGluZyA9IDA7XG4gIHJhdGluZ3MgPSBbXTtcblxuICBjb21tZW50Rm9ybUNvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2woJycsIFtWYWxpZGF0b3JzLnJlcXVpcmVkXSk7XG4gIGxvYWRpbmcgPSBmYWxzZTtcbiAgbG9hZGluZ1Jldmlld3MgPSBmYWxzZTtcbiAgQE91dHB1dCgpIHNhdmVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBwcm92aWRlclNlcnZpY2U6IFByb3ZpZGVyc1NlcnZpY2UsXG4gICAgICAgICAgICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcbiAgICAgICAgICAgICAgcHJpdmF0ZSBzbmFja2JhcjogTWF0U25hY2tCYXIsXG4gICAgICAgICAgICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgICAgICAgICAgIHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlKSB7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmxvYWRpbmdSZXZpZXdzID0gdHJ1ZTtcbiAgICB0aGlzLnByb3ZpZGVyU2VydmljZS5nZXRQcm92aWRlckJ5SWQodGhpcy5wcm92aWRlci5pZClcbiAgICAgIC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgIHRoaXMucHJvdmlkZXIgPSByZXNwb25zZTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIGdldHRpbmcgcHJvdmlkZXInKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgdGhpcy5wcm92aWRlclNlcnZpY2UuZ2V0UmF0aW5nc0ZvclByb3ZpZGVyKHRoaXMucHJvdmlkZXIuaWQpXG4gICAgICAudGhlbigocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnc3VjY2VzcycsIHJlc3BvbnNlKTtcbiAgICAgICAgdGhpcy5yYXRpbmdzID0gcmVzcG9uc2U7XG4gICAgICAgIHRoaXMubG9hZGluZ1Jldmlld3MgPSBmYWxzZTtcbiAgICAgIH0pO1xuICB9XG5cbiAgb25SYXRpbmdDaGFuZ2VkKHJhdGluZykge1xuICAgIGNvbnNvbGUubG9nKCdDaGFuZ2VkOiAnICsgcmF0aW5nKTtcbiAgICB0aGlzLnJhdGluZyA9IHJhdGluZztcbiAgfVxuXG4gIHN1Ym1pdFJhdGluZygpIHtcbiAgICBjb25zdCBjdXN0b21lclJldmlldzogQ3VzdG9tZXJSZXZpZXcgPSBuZXcgQ3VzdG9tZXJSZXZpZXcoKTtcbiAgICBjdXN0b21lclJldmlldy5pZCA9IHRoaXMucHJvdmlkZXIuaWQ7XG4gICAgY3VzdG9tZXJSZXZpZXcucmFuZ2UgPSB0aGlzLmN1c3RvbWVySWQ7XG4gICAgY3VzdG9tZXJSZXZpZXcuc3VibWl0dGVkT24gPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICBjdXN0b21lclJldmlldy5yYXRpbmcgPSB0aGlzLnJhdGluZztcbiAgICBjdXN0b21lclJldmlldy5jb21tZW50cyA9IHRoaXMuY29tbWVudEZvcm1Db250cm9sLnZhbHVlO1xuXG4gICAgY29uc3QgcmV2aWV3VXJsID0gYGh0dHBzOi8vYXBpLWRldi5icmlnaHRwYXRodnQuY29tL2N1c3RvbWVycy9yZXZpZXdzYDtcblxuICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG5cbiAgICBjb25zb2xlLmxvZygnY3VzdG9tZXJyZXZpZXcnLCBjdXN0b21lclJldmlldyk7XG5cbiAgICB0aGlzLmh0dHAucG9zdChyZXZpZXdVcmwsIGN1c3RvbWVyUmV2aWV3KVxuICAgICAgLnN1YnNjcmliZSgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc25hY2tiYXIub3BlbignUmV2aWV3IFNhdmVkJywgJ09LJywge1xuICAgICAgICAgIHZlcnRpY2FsUG9zaXRpb246ICd0b3AnLFxuICAgICAgICAgIGR1cmF0aW9uOiAyMDAwXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHNob3cgdGhlIHN1Y2Nlc3MgbWVzc2FnZVxuICAgICAgICB0aGlzLnNhdmVkLmVtaXQocmVzcG9uc2UpO1xuICAgICAgICAvLyB0aGlzLnJvdXRlci5uYXZpZ2F0ZUJ5VXJsKCcvaG9tZScpO1xuICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgfSwgKCkgPT4ge1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgIH0pO1xuICB9XG5cbn1cbiJdfQ==